<!-- [nzVisible]="drawerOpenFlag" -->
<gor-id-modal *ngIf="showIdModal" [isVisible]="false"></gor-id-modal>
<nz-drawer
  id="unliapp-drawer"
  [nzClosable]="false"
  [nzPlacement]="nzPlacement"
  [nzVisible]="openChangePlan"
  (nzOnClose)="close(false)"
  [nzWidth]="drawerWidth"
  [nzHeight]="onDrawerHeight()"
  [nzBodyStyle]="{ padding: 0, height: 581, overflow: 'hidden' }">
  <ng-container *nzDrawerContent>
    <div class="plan-builder-container">
      <div class="plan-builder-wrapper">
        <div
          class="plan-builder-header"
          [ngStyle]="{ 'padding-top': !finalPlan ? '16px' : '24px' }">
          <div
            class="plan-builder-header-left-section"
            id="side-section-plan-name">
            <!-- <span style="font-size: 12px"></span> -->
            <div
              class="plan-builder-header-left-section-amount"
              [ngClass]="{ 'justify-content-start': !finalPlan }"
              [ngStyle]="{ gap: !finalPlan ? '4px' : '12px' }">
              <div
                *ngIf="!finalPlan; else changPlanTitleBlock"
                class="change-plan-selected-title">
                Plan Selected
              </div>
              <ng-template #changPlanTitleBlock>
                <div class="change-plan-selected-title-2">Plan Selected</div>
              </ng-template>
              <div *ngIf="!finalPlan" class="change-plan-amount">
                <div>{{ finalCard.planName }}</div>
                <div>
                  <button
                    class="icon-button change-plan-amount-button-icon"
                    (click)="openIdModal()">
                    <img src="assets/images/info.svg" alt="info icon" />
                  </button>
                </div>
              </div>

              <!-- <button class="icon-button" (click)="openIdModal()">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg">
                  <g clip-path="url(#clip0_2576_391332)">
                    <circle cx="8" cy="8" r="6" fill="white" />
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M8 0C3.58182 0 0 3.58182 0 8C0 12.4182 3.58182 16 8 16C12.4182 16 16 12.4182 16 8C16 3.58182 12.4182 0 8 0ZM7.63636 3.63636C7.44348 3.63636 7.25849 3.71299 7.1221 3.84938C6.98571 3.98577 6.90909 4.17075 6.90909 4.36364C6.90909 4.55652 6.98571 4.74151 7.1221 4.8779C7.25849 5.01429 7.44348 5.09091 7.63636 5.09091H8C8.19289 5.09091 8.37787 5.01429 8.51426 4.8779C8.65065 4.74151 8.72727 4.55652 8.72727 4.36364C8.72727 4.17075 8.65065 3.98577 8.51426 3.84938C8.37787 3.71299 8.19289 3.63636 8 3.63636H7.63636ZM6.54545 6.54545C6.35257 6.54545 6.16759 6.62208 6.0312 6.75847C5.89481 6.89486 5.81818 7.07984 5.81818 7.27273C5.81818 7.46561 5.89481 7.6506 6.0312 7.78699C6.16759 7.92338 6.35257 8 6.54545 8H7.27273V10.1818H6.54545C6.35257 10.1818 6.16759 10.2584 6.0312 10.3948C5.89481 10.5312 5.81818 10.7162 5.81818 10.9091C5.81818 11.102 5.89481 11.287 6.0312 11.4234C6.16759 11.5597 6.35257 11.6364 6.54545 11.6364H9.45455C9.64743 11.6364 9.83241 11.5597 9.96881 11.4234C10.1052 11.287 10.1818 11.102 10.1818 10.9091C10.1818 10.7162 10.1052 10.5312 9.96881 10.3948C9.83241 10.2584 9.64743 10.1818 9.45455 10.1818H8.72727V7.27273C8.72727 7.07984 8.65065 6.89486 8.51426 6.75847C8.37787 6.62208 8.19289 6.54545 8 6.54545H6.54545Z"
                      fill="#2274E5" />
                  </g>
                  <defs>
                    <clipPath id="clip0_2576_391332">
                      <rect width="16" height="16" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button> -->

              <gor-selected-plan
                *ngIf="finalPlan"
                [svgUrl]="finalCard?.svg"
                [tags]="[finalCard?.badgeContent]"
                [planDetails]="[
                  finalCard?.planName_,
                  finalCard?.accessDataTitle,
                  finalCard?.accessData,
                  'App Data',
                  'Unlimited',
                  finalCard?.amount,
                  finalCard?.hasUnlimitedAccess
                ]"
                style="
                  width: 100%;
                  display: flex;
                  justify-content: center;
                  max-width: 211px;
                  align-self: center;
                "></gor-selected-plan>
            </div>
          </div>
          <div *ngIf="!finalPlan" class="plan-builder-header-right-section">
            <button class="icon-button" (click)="close(false)">
              <svg
                width="15"
                height="15"
                viewBox="0 0 15 15"
                fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M2.65828 0.792893C2.26775 0.402369 1.63459 0.402369 1.24407 0.792893C0.853541 1.18342 0.853541 1.81658 1.24407 2.20711L6.53696 7.5L1.24407 12.7929C0.853541 13.1834 0.853541 13.8166 1.24407 14.2071C1.63459 14.5976 2.26775 14.5976 2.65828 14.2071L7.95117 8.91421L13.2441 14.2071C13.6346 14.5976 14.2678 14.5976 14.6583 14.2071C15.0488 13.8166 15.0488 13.1834 14.6583 12.7929L9.36539 7.5L14.6583 2.20711C15.0488 1.81658 15.0488 1.18342 14.6583 0.792894C14.2678 0.402369 13.6346 0.402369 13.2441 0.792893L7.95117 6.08579L2.65828 0.792893Z"
                  fill="#1A458B" />
              </svg>
            </button>
          </div>
        </div>
        <div
          *ngIf="!finalPlan; else noFinalPlan"
          class="change-plan-content custom-scrollbar">
          <div class="change-plan-drop-down" *ngFor="let card of dropDownArray">
            <button
              class="change-plan-drop-down-head"
              (click)="card.expanded = !card.expanded">
              <div class="font-semibold">{{ card.planType }}</div>
              <div *ngIf="card.expanded; else elseExpand">
                <img
                  src="assets/images/svg/small-drop-up.svg"
                  alt="collapse icon" />
              </div>
              <ng-template #elseExpand>
                <div>
                  <img
                    src="assets/images/svg/small-drop-down.svg"
                    alt="expand icon" />
                </div>
              </ng-template>
            </button>
            <div
              *ngIf="card.expanded"
              class="change-plan-drop-down-content"
              [id]="card.planId">
              <div class="change-plan-drop-down-wrapper">
                <div class="change-plan-features">
                  <div>
                    <img
                      alt="check icon"
                      width="14px"
                      height="14px"
                      src="assets/images/svg/tick.svg" />
                    <div>Unli Allnet Calls & Text + Landline</div>
                  </div>

                  <div>
                    <img
                      alt="check icon"
                      width="14px"
                      height="14px"
                      src="assets/images/svg/tick.svg" />
                    <div>3GB GoWiFI Access</div>
                  </div>
                </div>
                <div class="change-plan-plans">
                  <div
                    (click)="onPlanSelect(plan)"
                    [class.selected-plan-wrapper]="
                      plan.planName === selectedPlan
                    "
                    class="change-plan-plan-item"
                    *ngFor="let plan of card.innerCard">
                    <button class="change-plan-plan-item-header">
                      <div
                        class="font-semibold"
                        [class.selected-plan]="plan.planName === selectedPlan">
                        {{ plan.planName_ }}
                      </div>
                      <div
                        class="change-plan-plan-item-features"
                        [class.selected-plan-features]="
                          plan.planName === selectedPlan
                        ">
                        <div>
                          <img
                            alt="check icon"
                            width="14px"
                            height="14px"
                            src="assets/images/svg/tick.svg" />
                          <div>
                            {{ plan.dataContent + ' ' + plan.dataTitle }}
                          </div>
                        </div>
                        <div *ngIf="plan.apps">
                          <img
                            alt="check icon"
                            width="14px"
                            height="14px"
                            src="assets/images/svg/tick.svg" />
                          <div class="d-flex">
                            <div>with&nbsp;</div>
                            <div class="font-semibold">Unli App</div>
                          </div>
                        </div>
                      </div>

                      <div
                        *ngIf="plan.badgeContent.length > 1"
                        class="badge"
                        [style.background]="plan.badgeColor.backgroundColor"
                        [style.color]="plan.badgeColor.color">
                        {{ plan.badgeContent }}
                      </div>
                      <!-- <ng-template #noBadge>
                      <div class="plan-benefits-icons">
                        <img src="assets/images/svg/wifi.svg"/>
                        <img src="assets/images/svg/circle.svg"/>
                        <img src="assets/images/svg/sms.svg"/>
                        <img src="assets/images/svg/circle-fill.svg"/>
                    </div>
                  </ng-template> -->
                    </button>
                    <div class="change-plan-plan-item-details">
                      <div
                        class="font-semibold change-plan-name-text"
                        [class.selected-plan]="plan.planName === selectedPlan">
                        <span class="font-light">â‚±</span
                        >{{ plan.planName.split(' ')[1] }}
                      </div>
                      <div class="plan-duration">
                        {{ plan.duration | titlecase }}
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noFinalPlan>
          <div class="plan-builder-content">
            <div class="text plan-builder-content-1-wrapper">
              <div
                class="text plan-builder-content-1"
                id="side-section-plan-inclusions">
                <div *ngFor="let plan of planDetails; index as i">
                  <svg
                    width="14"
                    height="10"
                    viewBox="0 0 14 10"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M12.5686 1.14386L5.14395 8.56848L1.43164 4.85617"
                      stroke="#1A458B"
                      stroke-width="2" />
                  </svg>
                  {{ plan }}
                </div>
              </div>
            </div>
            <div
              class="plan-builder-content-2"
              *ngIf="
                finalPlan?.dataFeature === 'Unli Data for 1 Chosen App' ||
                finalCard?.dataFeature === 'Unli Data for 1 Chosen App'
              ">
              <div class="plan-builder-content-2-head" id="tooltipContainer">
                <span class="plan-builder-content-2-head-title font-semibold"
                  >Choose your free unli app</span
                >

                <button
                  id="tooltip"
                  class="btn"
                  id="app-offer-info-icon-button"
                  data-bs-toggle="tooltip"
                  (click)="onInfoIconOfUnliList()">
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 16 16"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M6.60248 5.04472L6.95217 8.54867C6.97549 8.80966 7.09538 9.05262 7.28846 9.22992C7.45972 9.38719 7.67756 9.48268 7.90747 9.50298C7.54415 9.52591 7.20028 9.6804 6.94134 9.93934C6.66004 10.2206 6.502 10.6022 6.502 11C6.502 11.3978 6.66004 11.7794 6.94134 12.0607C7.22264 12.342 7.60418 12.5 8.002 12.5C8.39983 12.5 8.78136 12.342 9.06266 12.0607C9.34396 11.7794 9.502 11.3978 9.502 11C9.502 10.6022 9.34396 10.2206 9.06266 9.93934C8.80316 9.67984 8.45837 9.52524 8.09417 9.50283C8.32348 9.48223 8.54069 9.38681 8.71154 9.22992C8.90462 9.05262 9.02451 8.80966 9.04783 8.54867L9.39752 5.04472C9.41704 4.84947 9.39544 4.6523 9.33411 4.4659C9.27279 4.27951 9.1731 4.10803 9.04147 3.9625C8.90984 3.81698 8.74919 3.70064 8.56986 3.62098C8.39053 3.54132 8.19651 3.50011 8.00028 3.5L7.99972 3.5C7.80349 3.50011 7.60947 3.54132 7.43014 3.62098C7.25081 3.70064 7.09016 3.81698 6.95853 3.9625C6.8269 4.10803 6.72721 4.27951 6.66589 4.46591C6.60457 4.65228 6.58297 4.84943 6.60247 5.04465C6.60247 5.04468 6.60248 5.0447 6.60248 5.04472ZM15.5 8C15.5 9.98912 14.7098 11.8968 13.3033 13.3033C11.8968 14.7098 9.98912 15.5 8 15.5C6.01088 15.5 4.10322 14.7098 2.6967 13.3033C1.29018 11.8968 0.5 9.98912 0.5 8C0.5 6.01088 1.29018 4.10322 2.6967 2.6967C4.10322 1.29018 6.01088 0.5 8 0.5C9.98912 0.5 11.8968 1.29018 13.3033 2.6967C14.7098 4.10322 15.5 6.01088 15.5 8Z"
                      stroke="#2274E5" />
                  </svg>
                </button>
              </div>

              <gor-unli-list
                (selectedApp)="onAppSelected($event)"></gor-unli-list>
            </div>
          </div>
        </ng-template>

        <div class="plan-builder-content-3">
          <div class="plan-builder-content-3-button" [style.width.px]="323">
            <gor-pb-button
              style="width: 100%"
              *ngIf="!finalPlan; else noFinalPlan1"
              [height]="35"
              [disabled]="!selectedPlan"
              [buttonText]="'Choose'"
              (clickedProceed)="onChoose($event)"></gor-pb-button>
            <ng-template #noFinalPlan1>
              <gor-pb-button
                style="width: 100%"
                [height]="35"
                [disabled]="disableProceed()"
                [buttonText]="'Proceed'"
                (clickedProceed)="onProceed($event)"></gor-pb-button>
            </ng-template>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</nz-drawer>
